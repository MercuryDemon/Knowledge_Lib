17-06-2025 17:37
Tags: #z #petProject
# Тема - Сервис подбора врачей

## Задача

Необходимо разработать сервис для подбора врачей. Сервис должен поддерживать запись на приём к врачам, управление пользователями и регистрацию врачей (администратором). Сервис хранит данные в постоянной памяти. Проект разрабатывается как готовая к продакшну система: код покрыт функциональными и юнит-тестами, есть сбор метрик и визуализация на даш-бордах.

## Функционал

- Администратор может управлять врачами: регистрировать новых, редактировать существующие (слоты: "доступен", "занят"). Должна быть возможность производить поиск по врачам (по имени, специальности, статусу, местоположению клиники).

- Пользователь может записаться на приём к врачу, отменять запись. Оплата в сервисе отсутствует. Необходимо также обеспечить поиск по врачам (по дате, имени, специальности, статусу, местоположению клиники). [Опционально] возможность оставлять отзывы. API должен позволять пользователю получать информацию о конкретном враче и обо всех отзывах о нём.

## Требования

- Сервис написан с использованием Clean Architecture: четкое разделенение слоев (транспортный, сервисный, слой данных), все сущности выделены и отвязаны грамотным использованием интерфейсов.

- Код покрыт функциональными тестами.

- Управлением конфигурациями в продакшене. Приоритет: 1. env vars, 2. config.yml, 3. default values. Удобный и общепринятый инструмент здесь - Viper.

- Сервис должен поддерживать аутентификацию и авторизацию пользователей по email и паролю.

- Хранение только хешей, лучше ("с солью"), например, bcrypt.

- После входа API должен выдать авторизационный JWT-токен. [Опционально] использование Access + Refesh токенов; управление сессиями пользователей посредством хранения Refresh токенов в БД.

- Реализация 3-х базовых middleware: auth, logging, timeout.

- Сервис должен корректно обрабатывать ошибки и возвращать экранированные сообщения о них на фронтенд, а также валидировать входные данные.

- Сервис должен быть хорошо задокументирован. API должен быть описан с помощью Open API (он же Swagger). В сервисе должен быть настроен Swagger UI.

- Развертывание инстанса сервиса и БД в docker-compose. Для персистентного хранения данных настроить монтируемую директорию на хосте. [Опционально] Инстансы как поды в minikube.

- Реализовать на выбор 2/3 вещей:

- Настроить сбор метрик с помощью Prometheus и визуализацию в Grafana. Необходимо собирать метрики, такие как количество запросов к API (подсчет RPS), время ответа, количество ошибок. [Опционально] сбор бизнес-метрик: количество забронированных [зависит от темы] за день и количество отмененных […].

- Настроить мониторинг и трассировку запросов при помощи opentelemetry + Jaeger.

- Настроить агрегацию логов с использованием стека ELK: Elasticsearch, Logstash, Kibana. Логи должны содержать информацию о запросах, ошибках и ключевых действиях пользователей.

- **Дополнительный сервис 1 на практику с gRPC**: аудит-логгер.

- Аудит: сервис бронирования реализует у себя клиент аудита, сам сервис аудита представляет собой gRPC-сервер c его отдельной БД (например, Mongo DB). Отдельный репозиторий.

- **Дополнительный сервис 2 на практику с Kafka (высший пилотаж, необязательно)**: сервис email-нотификаций для пользователей об изменении статуса билета или изменения даты/времени мероприятия. Можно реализовать как отдельный репозиторий, можно внутри основного:
```
ticket-booking/
└── cmd/
    ├── booking-service/
    │   └── main.go
    └── notification-service/
        └── main.go
```

- **Усложнение 1:** реализовать in-memory cache (на основе мапы в Го) для ускорения запросов к базе из таблицы мероприятий. Реализовать cache-aside стратегию + LRU eviction.

- **Усложнение 2:** заменить in-memory cache на Redis. Добавить TTL eviction (volatile-lru).

## Советы начинающим

- Не пугаемся.

- Поступательно добавляем логику и расширяем приложение. НЕ НАДО сразу приступать ко всему, что написано в требованиях, хотя бы потому, что многие темы еще не изучены, и будут рассмотрены позже.

- Например, сначала можно вообще не реализовывать разделение по доступу (администратор/пользователь) и не вводить авторизацию, а сосредоточиться на реализации самых простых и понятных ручек (handler'ов), обеспечивающих CRUD функциональность.

- Первое время хранить данные своего сервиса можно в памяти (`repository/inmemory`) - как правило, для этого используют мапы (ключ-структура). Если есть желание и минимальный опыт с SQL БД, можно попробовать сразу начать работать с ней, например Postgres или MySQL.

- Для удобной визуализации схем и отладки баз данных SQL можно использовать программу-клиент DBeaver ([https://dbeaver.io/](https://dbeaver.io/)) или Jetbrains DataGrip. Последняя платная, но пропатченную версию можно скачать тут:

- `Windows` - [https://rutracker.org/forum/viewtopic.php?t=6576403](https://rutracker.org/forum/viewtopic.php?t=6576403)

- `Mac M Chip` - [https://nnmclub.to/forum/viewtopic.php?t=1698241](https://nnmclub.to/forum/viewtopic.php?t=1698241)

- Если что-то становится непонятно, спрашивай меня.


### Zero-Links
- [[00 Golang]]
- [[00 Обучение]]
- 


### Links
- https://buildin.ai/gotodev/share/c21fbe71-3417-4eaf-bd51-4e7877959eac?code=BDZ84M
- https://dev-gang.ru/article/upravlenie-konfiguraciei-v-go-miyyqxdq7q/ - пакет Viper
- 

